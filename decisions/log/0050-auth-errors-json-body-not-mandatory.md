
# 50. Make JSON Error Body Optional for Authentication Errors

Date: 2025-10-07

## Status

Proposed

## Context

The current PACT Technical Specifications (versions 2.x and 3.0) require that authentication error responses include both:
1. An appropriate HTTP status code (400 or 401)
2. A JSON error object in the response body with specific structure:

```json
{
  "code": "BadRequest",
  "message": "Invalid token provided"
}
```

Starting June 2025, the PACT Conformance Tool has been used by several Software Solution Providers to test the conformance of their APIs to the PACT specification.

Among numerous other tests, the conformance tool also tests an API for correctly handling invalid input. Specifically, test cases #6, #7, and #16 send requests with an invalid authentication token, expecting the API under test to return an error. The PACT technical specifications require that, in addition to the regular HTTP status code (400 or 401) the response ALSO includes a JSON error object (see above).

In practice, APIs typically (and correctly) return an HTTP 400 or 401 status code, but some do not include the required JSON error object in the response body. This is because often, these authentication errors are typically generated by common infrastructure (such as API gateways, OAuth providers, or authentication middleware) where the JSON payload of the error response is not under direct control of the PACT API implementation itself. 

The current specification requirement creates unnecessary implementation barriers, especially for organizations using standard authentication infrastructure that may not provide customizable error response bodies.

## Proposal

Make the JSON error body **optional** for authentication errors while keeping it **mandatory** for all other API errors.

### Specific Changes

1. **Authentication Errors (HTTP 400, 401 from authentication endpoints)**: 
   - JSON error body becomes optional
   - HTTP status code alone is sufficient for conformance
   
2. **All Other API Errors**: 
   - JSON error body remains mandatory (no change to existing behavior)

### Technical Specification Changes

**Current specification text:**
> "All error responses MUST include a JSON error object with code and message fields"

**Proposed specification text:**
> "All error responses MUST include a JSON error object with code and message fields, except for authentication errors (HTTP 400, 401 from authentication endpoints) where the JSON error body is optional"

### Conformance Tool Changes

The PACT Conformance Tool test cases 6, 7, and 16 will be updated to:
- Continue testing for correct HTTP status codes (400 or 401)
- Make JSON error body validation optional for authentication endpoints
- Continue requiring JSON error bodies for all other error scenarios

## Benefits

1. **Reduced Implementation Barriers**: Allows organizations to use standard authentication infrastructure without requiring custom error response formatting
2. **Standards Alignment**: Aligns with common OAuth 2.0 and HTTP authentication practices where infrastructure-level errors may not include custom JSON payloads
3. **Practical Compatibility**: Enables successful integration with existing authentication systems that cannot easily modify error response formats
4. **Maintained Error Quality**: Preserves detailed error reporting for application-level errors while relaxing requirements only where infrastructure limitations exist

## Consequences

### Positive
- Improved compatibility with standard authentication infrastructure
- Reduced integration effort for implementers using existing OAuth/authentication systems
- Maintained backward compatibility (existing implementations continue to work)
- No impact on application-level error handling quality

### Potential Concerns
- Slightly less consistent error response format across all endpoints
- Clients may need to handle authentication errors differently (status code only vs. JSON body)
- Reduced debugging information for authentication failures (though HTTP status codes still provide basic error classification)

### Backwards Compatibility
This change is **backwards compatible** because:
- Existing implementations that include JSON error bodies continue to work unchanged
- The change only relaxes requirements (makes optional what was previously mandatory)
- No existing behavior is broken or changed

## Implementation Notes

1. **For API Implementers**: Authentication errors MAY omit the JSON error body, but including it is still valid and encouraged where possible
2. **For Client Implementations**: Should handle authentication errors by checking HTTP status code primarily, with JSON error body as supplementary information when available
3. **For Conformance Testing**: Updated test cases will validate HTTP status codes for authentication errors and optionally check JSON error body structure when present

## Decision

**Proposed** - To be presented at the next Tech WG meeting for community feedback and consensus.